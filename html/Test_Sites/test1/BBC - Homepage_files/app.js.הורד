(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var setupDelayedRedirect=require("./setup-delayed-redirect");var linkClickedFactory=require("./mvtEvents").linkClickedFactory;var configureDwellCheck=require("./dwell-check-factory");var configureVariant=require("./configure-variant");var setupBreakingNewsObserver=require("./setup-breaking-news-observer");var isBreakingNewsPresent=setupBreakingNewsObserver.isBreakingNewsPresent;var reveal=require("./reveal");var shareToolsInViewport=require("./share-tools");function revealWhenReady(discoLayerContainer,placeholder){if(isBreakingNewsPresent()){return}if(window.document.readyState==="complete"){reveal(discoLayerContainer,placeholder)}else{document.addEventListener("readystatechange",function(){if(window.document.readyState==="complete"){reveal(discoLayerContainer,placeholder)}})}}function addDiscoLayerDOMEventsFactory(istats,megavolt){var fireEventOnArticleEnd=function(){var shareToolsEventFired=false;return function(){if(!shareToolsEventFired&&shareToolsInViewport()){shareToolsEventFired=true;megavolt.trackEvents("end-article-sharetools",function(){})}}}();function addDiscoLayerDOMEvents(err,data,discoLayerContainer){if(err){return}else{istats.log("load","discovery-layer",data.statsData);setupDelayedRedirect(data);var clickCallback=linkClickedFactory(istats,megavolt,data);data.link.addEventListener("click",clickCallback,false);var opts={region:data.link,linkLocation:"discovery-layer",dl_headline:data.statsData.dl_headline};istats.track("internal",opts);function setUpListeners(animated,placeholder){var twoSecondViewCheck=configureDwellCheck(istats,data,discoLayerContainer,2e3,"two-second-view");var fiveSecondViewCheck=configureDwellCheck(istats,data,discoLayerContainer,5e3,"five-second-view");window.addEventListener("scroll",fireEventOnArticleEnd);window.addEventListener("resize",fireEventOnArticleEnd);function viewCheck(){twoSecondViewCheck();fiveSecondViewCheck()}if(!animated){viewCheck()}discoLayerContainer.addEventListener("transitionend",viewCheck);setupBreakingNewsObserver(discoLayerContainer,placeholder);revealWhenReady(discoLayerContainer,placeholder)}configureVariant(data.variant,discoLayerContainer,setUpListeners)}}return addDiscoLayerDOMEvents}module.exports=addDiscoLayerDOMEventsFactory},{"./configure-variant":2,"./dwell-check-factory":4,"./mvtEvents":9,"./reveal":11,"./setup-breaking-news-observer":13,"./setup-delayed-redirect":14,"./share-tools":15}],2:[function(require,module,exports){var scrollEvents=require("./scroll-events");var stickyOnScrollUpOrArticleEndHandler=scrollEvents.stickyOnScrollUpOrArticleEndHandler;var stickyOnScrollUpHandler=scrollEvents.stickyOnScrollUpHandler;var stickyAtTopOnLoadScrollHandler=scrollEvents.stickyAtTopOnLoadScrollHandler;var stickyAtTopOnLoadInit=scrollEvents.stickyAtTopOnLoadInit;var utilities=require("./utilities");var generatePlaceholderElement=utilities.generatePlaceholderElement;function attachPlaceHolder(cssClasses,position){var discoLayerPlaceholder=generatePlaceholderElement(cssClasses);if(position==="bottom"){var pageBody=document.getElementsByTagName("body")[0];pageBody.appendChild(discoLayerPlaceholder)}else if(position==="top"){var orbBody=document.getElementById("orb-modules");orbBody.prepend(discoLayerPlaceholder)}return discoLayerPlaceholder}function addDLCssClasses(discoLayer,cssClasses){cssClasses.forEach(function(cssClass){discoLayer.classList.add(cssClass)})}function configureVariant(variant,discoLayer,setUpListeners){var placeholder;switch(variant){case"v1_sticky_on_load_top":var animated=true;placeholder=attachPlaceHolder(["dl-box","dl-box--hidden"],"top");addDLCssClasses(discoLayer,["dl-box--inline","dl-box--animate_in"]);addDLCssClasses(placeholder,["dl-box--removed"]);setUpListeners(animated,placeholder);stickyAtTopOnLoadInit(discoLayer,placeholder);window.addEventListener("scroll",function(scrollEvent){stickyAtTopOnLoadScrollHandler(scrollEvent,discoLayer,placeholder)});break;case"v2_sticky_on_load_bottom":var animated=true;placeholder=attachPlaceHolder(["dl-box","dl-box--hidden"],"bottom");addDLCssClasses(discoLayer,["dl-box--sticky_bottom","dl-box--animate_in"]);setUpListeners(animated,placeholder);break;case"v3_sticky_on_scroll_up_or_article_end_top":var animated=true;placeholder=attachPlaceHolder(["dl-box","dl-box--hidden"],"top");addDLCssClasses(discoLayer,["dl-box--sticky_top","dl-box--animate_in"]);window.addEventListener("scroll",function(scrollEvent){stickyOnScrollUpHandler(scrollEvent,discoLayer,placeholder,function(){setUpListeners(animated,placeholder)})});window.addEventListener("scroll",function(scrollEvent){stickyOnScrollUpOrArticleEndHandler(scrollEvent,function(){setUpListeners(animated,placeholder)})});break;case"v4_sticky_on_scroll_up_or_article_end_bottom":var animated=true;placeholder=attachPlaceHolder(["dl-box","dl-box--hidden"],"bottom");addDLCssClasses(discoLayer,["dl-box--sticky_bottom","dl-box--animate_in"]);window.addEventListener("scroll",function(scrollEvent){stickyOnScrollUpOrArticleEndHandler(scrollEvent,function(){setUpListeners(animated,placeholder)})});break}}module.exports=configureVariant},{"./scroll-events":12,"./utilities":16}],3:[function(require,module,exports){module.exports={CURRENT_EXPERIMENT:"disco03_positioning"}},{}],4:[function(require,module,exports){var discoveryLayerViewedFactory=require("./mvtEvents").discoveryLayerViewedFactory;var fractionInViewport=require("./fraction-in-viewport");var SCROLL_STATS_MODULE_VIEW_THRESHOLD=.5;function dwellCheckFactory(element,dwelledHandler,viewPeriodMs){return function(){var timeout="dwellScrollTimeout"+viewPeriodMs;if(fractionInViewport(element)<SCROLL_STATS_MODULE_VIEW_THRESHOLD){window.clearTimeout(element[timeout]);delete element[timeout]}else if(!element[timeout]){element[timeout]=window.setTimeout(dwelledHandler,viewPeriodMs)}}}function configureDwellCheck(istats,data,discoLayer,viewPeriod,actionType){var viewedCallback=discoveryLayerViewedFactory(istats,data,actionType);var dwellCheck=dwellCheckFactory(discoLayer,viewedCallback,viewPeriod);window.addEventListener("scroll",dwellCheck,false);window.addEventListener("resize",dwellCheck,false);return dwellCheck}module.exports=configureDwellCheck},{"./fraction-in-viewport":6,"./mvtEvents":9}],5:[function(require,module,exports){function getStatsData(variant,source,discoLayer){var discoLayerLink=discoLayer.getElementsByClassName("dl-itm")[0];return{variant:variant,statsData:{dl_link_url:discoLayerLink.getAttribute("href"),dl_headline:discoLayerLink.textContent,dl_source:source},link:discoLayerLink}}function renderDiscoLayer(variant,source,discoBodyHtml,done){var div=document.createElement("div");div.innerHTML=discoBodyHtml;var discoLayer=div.firstChild;done(null,getStatsData(variant,source,discoLayer),discoLayer)}function selectFeed(){var CONTENT_FEEDS=["automated","editorial","media-planning"];var date=new Date;return CONTENT_FEEDS[date.getMinutes()%CONTENT_FEEDS.length]}function fetchDiscoLayer(contentUrl,variant,done){var chosenFeed=selectFeed();var sourceContentUrl=contentUrl+"/"+chosenFeed+".html";var discoveryLayerRequest=new XMLHttpRequest;discoveryLayerRequest.onreadystatechange=function(){if(discoveryLayerRequest.readyState===XMLHttpRequest.DONE){if(discoveryLayerRequest.status===200){var discoBodyHtml=discoveryLayerRequest.responseText;renderDiscoLayer(variant,chosenFeed,discoBodyHtml,done)}else{var error=new Error("Unexpected error");done(error)}}};discoveryLayerRequest.open("GET",sourceContentUrl);discoveryLayerRequest.send();discoveryLayerRequest.onerror=done}function fetchAndRenderDiscoLayer(args,done){var nav=args.nav;var contentUrl=args.contentUrl;var cssUrl=args.cssUrl;var variant=args.variant;if(typeof done!=="function"){done=function(){}}nav.loadCss(cssUrl,function(){fetchDiscoLayer(contentUrl,variant,done)})}module.exports=fetchAndRenderDiscoLayer},{}],6:[function(require,module,exports){var isElementHidden=require("./utilities").isElementHidden;function fractionInViewport(element){var viewportHeight=window.innerHeight;var rect=element.getBoundingClientRect();if(isElementHidden(element)){return 0}if(rect.top>0&&rect.bottom<viewportHeight){return 1}else if(rect.top<0&&rect.bottom<0||rect.top>viewportHeight||rect.height===0){return 0}else{var belowFold=rect.bottom>viewportHeight;var topVisible=Math.max(0,belowFold?viewportHeight-rect.top:rect.top);var bottomVisible=Math.max(0,belowFold?viewportHeight-rect.bottom:rect.bottom);return(topVisible+bottomVisible)/rect.height}}module.exports=fractionInViewport},{"./utilities":16}],7:[function(require,module,exports){function hide(discoLayerContainer,placeholder){if(placeholder){placeholder.classList.add("dl-box--hidden")}discoLayerContainer.addEventListener("transitionend",function(){var discoLayerVisibility=window.getComputedStyle(discoLayerContainer).getPropertyValue("visibility");if(discoLayerVisibility==="hidden"){discoLayerContainer.style.display="none"}});discoLayerContainer.classList.remove("dl-box--animate_in");discoLayerContainer.classList.add("dl-box--animate_out");discoLayerContainer.classList.add("dl-box--removed")}module.exports=hide},{}],8:[function(require,module,exports){require("./polyfills/parent-node-prepend");var whenToShow=require("./when-to-show");var fetchAndRenderDiscoLayer=require("./fetch-render-disco-layer");var addDiscoLayerDOMEventsFactory=require("./add-disco-layer-dom-events");var CURRENT_EXPERIMENT=require("./constants").CURRENT_EXPERIMENT;window.define(["orb/nav","istats-1","megavolt-client"],function(nav,istats,megavolt){function runDiscoLayer(showResult,contentUrl,cssUrl){if(showResult.shouldShow){megavolt.getBuckets({activate:true},function(buckets){var variant=buckets[CURRENT_EXPERIMENT];if(variant){istats.log("target","discovery-layer");var args={nav:nav,contentUrl:contentUrl,cssUrl:cssUrl,variant:variant};var addDiscoLayerDOMEvents=addDiscoLayerDOMEventsFactory(istats,megavolt);fetchAndRenderDiscoLayer(args,addDiscoLayerDOMEvents)}})}else if(showResult.reasons.indexOf("section")<0){istats.log("no-target","discovery-layer",{"dl-no-target":showResult.reasons.join("-")})}}function run(contentUrl,cssUrl){whenToShow(function(showResult){runDiscoLayer(showResult,contentUrl,cssUrl)})}return{run:run,whenToShow:whenToShow}})},{"./add-disco-layer-dom-events":1,"./constants":3,"./fetch-render-disco-layer":5,"./polyfills/parent-node-prepend":10,"./when-to-show":17}],9:[function(require,module,exports){var CURRENT_EXPERIMENT=require("./constants").CURRENT_EXPERIMENT;var THREE_MONTHS_MS=80352e5;function addStoredLabel(istats,variant,labelSuffix){var storedLabels={};var labelKey="mvt_"+CURRENT_EXPERIMENT+"_"+variant+"_"+labelSuffix;storedLabels[labelKey]="1";istats.addStoredLabels(storedLabels,THREE_MONTHS_MS)}function discoveryLayerViewedFactory(istats,data,actionType){var triggered=false;return function(){if(!triggered){triggered=true;istats.log(actionType,"discovery-layer",data.statsData);addStoredLabel(istats,data.variant,"target")}}}function linkClickedFactory(istats,megavolt,data){var triggered=false;return function(){if(!triggered){triggered=true;istats.log("click","discovery-layer",data.statsData);megavolt.trackEvents("click",function(){});addStoredLabel(istats,data.variant,"conversion")}}}module.exports={linkClickedFactory:linkClickedFactory,discoveryLayerViewedFactory:discoveryLayerViewedFactory}},{"./constants":3}],10:[function(require,module,exports){(function(arr){arr.forEach(function(item){if(item.hasOwnProperty("prepend")){return}Object.defineProperty(item,"prepend",{configurable:true,enumerable:true,writable:true,value:function prepend(){var argArr=Array.prototype.slice.call(arguments);var docFrag=document.createDocumentFragment();argArr.forEach(function(argItem){var isNode=argItem instanceof Node;docFrag.appendChild(isNode?argItem:document.createTextNode(String(argItem)))});this.insertBefore(docFrag,this.firstChild)}})})})([Element.prototype,Document.prototype,DocumentFragment.prototype])},{}],11:[function(require,module,exports){function reveal(discoLayerContainer,placeholder){function showDiscoLayerContainer(){discoLayerContainer.classList.remove("dl-box--hidden")}function showPlaceholder(){if(placeholder&&placeholder.classList){placeholder.classList.remove("dl-box--hidden");discoLayerContainer.removeEventListener("transitionend",showPlaceholder)}}discoLayerContainer.addEventListener("transitionend",showPlaceholder);var orbBody=document.getElementById("orb-modules");requestAnimationFrame(function(){orbBody.prepend(discoLayerContainer);requestAnimationFrame(showDiscoLayerContainer)})}module.exports=reveal},{}],12:[function(require,module,exports){var utilities=require("./utilities");var getEventView=utilities.getEventView;var getBottomOfOrbHeader=utilities.getBottomOfOrbHeader;var shareToolsInViewport=require("./share-tools");var SCROLL_UP_PIXEL_THRESHOLD=7;var stickyApplied=false;var lastScrollPosition=0;function stickyOnScrollUpOrArticleEndHandler(scrollEvent,done){var currentScrollPosition=getEventView(scrollEvent).scrollY;if(!stickyApplied){var scrollUpDistance=lastScrollPosition-currentScrollPosition;var scale=window.devicePixelRatio!==undefined?window.devicePixelRatio:1;var userScrolledUp=scrollUpDistance>SCROLL_UP_PIXEL_THRESHOLD*scale;if(userScrolledUp||shareToolsInViewport()){stickyApplied=true;if(typeof done==="function"){done()}}}lastScrollPosition=currentScrollPosition}function toggleStickySliverTop(scrollEvent,discoveryLayer,placeholder){var dlWindow=getEventView(scrollEvent);if(dlWindow.scrollY>getBottomOfOrbHeader()){discoveryLayer.classList.add("dl-box--sticky_top");discoveryLayer.classList.remove("dl-box--inline");placeholder.classList.remove("dl-box--removed")}else{discoveryLayer.classList.remove("dl-box--sticky_top");discoveryLayer.classList.add("dl-box--inline");placeholder.classList.add("dl-box--removed")}}function stickyAtTopOnLoadScrollHandler(scrollEvent,discoveryLayer,placeholder){toggleStickySliverTop(scrollEvent,discoveryLayer,placeholder)}function stickyAtTopOnLoadInit(discoLayer,placeholder){var currentScrollPosition=window.pageYOffset;var initEvent={target:{defaultView:{scrollY:currentScrollPosition}}};stickyAtTopOnLoadScrollHandler(initEvent,discoLayer,placeholder)}function stickyOnScrollUpHandler(scrollEvent,discoveryLayer,placeholder,done){var dlWindow=getEventView(scrollEvent);var currentScrollPosition=dlWindow.scrollY;var scrollUpDistance=lastScrollPosition-currentScrollPosition;var scale=window.devicePixelRatio!==undefined?window.devicePixelRatio:1;if(stickyApplied){toggleStickySliverTop(scrollEvent,discoveryLayer,placeholder)}else if(scrollUpDistance>SCROLL_UP_PIXEL_THRESHOLD*scale){stickyApplied=true;toggleStickySliverTop(scrollEvent,discoveryLayer,placeholder);if(typeof done==="function"){done()}}lastScrollPosition=currentScrollPosition}function stickyOnArticleEndScrollHandler(scrollEvent,discoveryLayer,placeholder,done){if(stickyApplied){toggleStickySliverTop(scrollEvent,discoveryLayer,placeholder)}else if(shareToolsInViewport()){stickyApplied=true;toggleStickySliverTop(scrollEvent,discoveryLayer,placeholder);if(typeof done==="function"){done()}}}module.exports={stickyOnScrollUpOrArticleEndHandler:stickyOnScrollUpOrArticleEndHandler,stickyOnScrollUpHandler:stickyOnScrollUpHandler,stickyAtTopOnLoadScrollHandler:stickyAtTopOnLoadScrollHandler,stickyAtTopOnLoadInit:stickyAtTopOnLoadInit}},{"./share-tools":15,"./utilities":16}],13:[function(require,module,exports){var hide=require("./hide");function getBreakingNewsContainer(){return document.getElementById("breaking-news-container")}function isBreakingNewsPresent(breakingNewsContainer){var theBreakingNewsContainer=breakingNewsContainer||getBreakingNewsContainer();if(!theBreakingNewsContainer){return false}return theBreakingNewsContainer.childNodes.length>0}function hideTheDiscoLayerOnBreakingNews(breakingNewsContainer,discoveryLayer,placeholder){if(isBreakingNewsPresent(breakingNewsContainer)){hide(discoveryLayer,placeholder)}}function setupBreakingNewsObserver(discoveryLayer,placeholder){var breakingNewsContainer=getBreakingNewsContainer();if(breakingNewsContainer){var breakingNewsObserver=new MutationObserver(function(){hideTheDiscoLayerOnBreakingNews(breakingNewsContainer,discoveryLayer,placeholder)});var config={attributes:false,childList:true,characterData:false};breakingNewsObserver.observe(breakingNewsContainer,config)}}module.exports=setupBreakingNewsObserver;module.exports.isBreakingNewsPresent=isBreakingNewsPresent},{"./hide":7}],14:[function(require,module,exports){var REDIRECT_DELAY=500;function isMiddleBtnClicked(e){var MODERN_MIDDLE_BUTTON=1;var IE_BROWSER_MIDDLE_BUTTON=4;return e.which===null?e.button===IE_BROWSER_MIDDLE_BUTTON:e.button===MODERN_MIDDLE_BUTTON}function setupDelayedRedirect(data){data.link.onclick=function(e){var modifierKey=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;var redirect=function(){};var newWindowRequested=modifierKey||isMiddleBtnClicked(e)||data.link.target&&!data.link.target.match(/^_(self|parent|top)$/i);if(!newWindowRequested){redirect=function(){window.location.href=data.link.href};setTimeout(redirect,REDIRECT_DELAY);return false}}}module.exports=setupDelayedRedirect},{}],15:[function(require,module,exports){var fractionInViewport=require("./fraction-in-viewport");var SHARE_TOOLS_VIEW_THRESHOLD=.5;var shareToolsContainer=undefined;function getArticleShareToolsContainer(){if(!shareToolsContainer){shareToolsContainer=document.getElementsByClassName("share")[0]}return shareToolsContainer}function shareToolsInViewport(){return fractionInViewport(getArticleShareToolsContainer())>=SHARE_TOOLS_VIEW_THRESHOLD}module.exports=shareToolsInViewport},{"./fraction-in-viewport":6}],16:[function(require,module,exports){function getDiscoLayerContainer(){return document.getElementById("discoLayer")}function getDiscoLayerPlaceholder(){return document.getElementById("dl-placeholder")}function getBreakingNewsContainer(){return document.getElementById("breaking-news-container")}function getBottomOfOrbHeader(){var orbHeader=document.getElementById("orb-header");return orbHeader.offsetTop+orbHeader.offsetHeight}function setElementHeight(element,value){element.style.height=value+"px"}function getEventView(event){return event.target.defaultView}function isElementHidden(element){var visibility=window.getComputedStyle(element).getPropertyValue("visibility");var display=window.getComputedStyle(element).getPropertyValue("display");return visibility==="hidden"||display==="none"}function generatePlaceholderElement(cssClasses){var placeholder=document.createElement("div");placeholder.setAttribute("id","dl-placeholder");cssClasses.forEach(function(cssClass){placeholder.classList.add(cssClass)});return placeholder}module.exports={getDiscoLayerContainer:getDiscoLayerContainer,getDiscoLayerPlaceholder:getDiscoLayerPlaceholder,getBreakingNewsContainer:getBreakingNewsContainer,getBottomOfOrbHeader:getBottomOfOrbHeader,setElementHeight:setElementHeight,getEventView:getEventView,isElementHidden:isElementHidden,generatePlaceholderElement:generatePlaceholderElement}},{}],17:[function(require,module,exports){var isBreakingNewsPresent=require("./setup-breaking-news-observer").isBreakingNewsPresent;var assetTypes=["STY","CSP","LIV","LEP","PGL"];var sectionUris=["news/entertainment-arts","news/entertainment_and_arts","news/technology","news/business","news/science-environment","news/science_and_environment","news/health","news/education","news/stories","news/in_pictures","news/in-pictures"];function usingModernBrowser(){var myNav=navigator.userAgent.toLowerCase();return!(myNav.indexOf("msie")>-1||myNav.indexOf("opera mini")>-1)||parseInt(myNav.split("msie")[1],10)>10}function getSectionUri(){try{return window.config.asset.section.uri}catch(error){return undefined}}function sectionMatches(){var uri=getSectionUri();if(!uri){return false}for(var i=0;i<sectionUris.length;i++){if(uri.indexOf(sectionUris[i])>-1){return true}}return false}function getViewportWidth(){return document.getElementById("orb-header").offsetWidth}function checkViewportWidth(){var viewportWidth=getViewportWidth();return viewportWidth>=320&&viewportWidth<600}function getAssetType(){return window.config.asset.type}function noVideoOnPage(){return document.getElementsByClassName("media-player").length===0}function rightAssetType(){try{var assetType=getAssetType();var validAssetType=assetTypes.indexOf(assetType.toUpperCase())>-1;return validAssetType}catch(error){return false}}function checkCookies(){try{return window.bbccookies.cookiesEnabled()&&window.bbccookies.readPolicy("performance")}catch(error){return false}}function getAdvertisingFlags(){return window.config.asset.options.allowAdvertising&&window.config.features2.adverts}function isAdvertisingAllowed(){try{return getAdvertisingFlags()}catch(error){return false}}function areShareToolsPresent(){return document.getElementsByClassName("share").length>0}function isUKUser(done){if(!window.orb.fig.load){window.orb.fig.load=function(callback){callback(window.orb.fig)}}window.orb.fig.load(function(fig){done(!!fig.geo.isUK())},function(){done(false)})}function breakingNewsIsNotPresent(){return!isBreakingNewsPresent()}function mapReason(result,reasons,reason){if(!result){reasons.push(reason)}return result}function checkPageParamsAndGetReasons(reasons,isUK){var results=[mapReason(isUK,reasons,"international"),mapReason(sectionMatches(),reasons,"section"),mapReason(checkViewportWidth(),reasons,"viewport"),mapReason(rightAssetType(),reasons,"assetType"),mapReason(isAdvertisingAllowed(),reasons,"advert"),mapReason(checkCookies(),reasons,"cookies"),mapReason(areShareToolsPresent(),reasons,"share"),mapReason(noVideoOnPage(),reasons,"video"),mapReason(breakingNewsIsNotPresent(),reasons,"breakingNews")];return results.every(function(value){return value===true})}function whenToShow(done){if(usingModernBrowser()){var reasons=[];isUKUser(function(isUK){done({shouldShow:checkPageParamsAndGetReasons(reasons,isUK),reasons:reasons})})}}module.exports=whenToShow},{"./setup-breaking-news-observer":13}]},{},[8]);